{"version":3,"file":"BundleProductOptions-h6fo1WsC.js","sources":["../../../src/components/product/BundleProductOptions.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, memo } from 'react';\nimport { formatPrice } from '../../utils/formatters';\n\nconst BundleProductOptions = ({ product, onBundleSelectionChange }) => {\n  const { items: bundleItems } = product;\n  const [selectedBundleOptions, setSelectedBundleOptions] = useState({});\n  const [bundleTotalPrice, setBundleTotalPrice] = useState(product.price_range.minimum_price.final_price.value);\n\n  // Initialize selected options\n  useEffect(() => {\n    const initialSelections = {};\n    let initialPrice = parseFloat(product.price_range.minimum_price.final_price.value);\n\n    if (bundleItems) {\n      bundleItems.forEach(item => {\n        if (item.options && item.options.length > 0) {\n          const defaultOption = item.options.find(opt => opt.is_default) || item.options[0];\n          if (defaultOption) {\n            initialSelections[item.option_id] = {\n              option_id: item.option_id,\n              selection_id: defaultOption.id,\n              quantity: defaultOption.quantity,\n              price: parseFloat(defaultOption.price),\n              product_id: defaultOption.product.id, // Store product_id for cart\n              sku: defaultOption.product.sku, // Store SKU for cart\n            };\n            // Adjust initial price if bundle price is dynamic and default option has a price\n            // This depends on Magento's bundle pricing (fixed vs dynamic)\n            // For simplicity, assuming price is additive for dynamic bundles if option.price > 0\n            // If product price already includes default options, this logic might need adjustment\n            if (product.price_view === 'PRICE_RANGE') { // Indicates dynamic pricing\n                 initialPrice += parseFloat(defaultOption.price) * defaultOption.quantity;\n            }\n          }\n        }\n      });\n    }\n    setSelectedBundleOptions(initialSelections);\n    // setBundleTotalPrice(initialPrice); // Initial price calculation might be complex\n    if (onBundleSelectionChange) {\n      onBundleSelectionChange(initialSelections, initialPrice);\n    }\n  }, [bundleItems, product.price_range.minimum_price.final_price.value, product.price_view, onBundleSelectionChange]);\n\n  const handleOptionChange = (itemOptionId, selectionId, quantity) => {\n    setSelectedBundleOptions(prev => {\n      const newSelections = { ...prev };\n      const item = bundleItems.find(i => i.option_id === itemOptionId);\n      const selectedOpt = item.options.find(o => o.id === selectionId);\n\n      if (selectedOpt) {\n        newSelections[itemOptionId] = {\n          option_id: itemOptionId,\n          selection_id: selectionId,\n          quantity: quantity || selectedOpt.quantity, // Use passed quantity or default\n          price: parseFloat(selectedOpt.price),\n          product_id: selectedOpt.product.id,\n          sku: selectedOpt.product.sku,\n        };\n      }\n      return newSelections;\n    });\n  };\n\n  const handleQuantityChange = (itemOptionId, selectionId, newQuantity) => {\n    const qty = parseInt(newQuantity, 10);\n    if (qty >= 0) { // Allow 0 if item can be deselected, or 1 if always required\n      handleOptionChange(itemOptionId, selectionId, qty);\n    }\n  };\n\n  // Recalculate total price when selections change\n  useEffect(() => {\n    let currentPrice = parseFloat(product.price_range.minimum_price.final_price.value);\n    if (product.price_view === 'PRICE_RANGE') { // Dynamic pricing\n        currentPrice = 0; // Start from 0 for dynamic bundles if base price is for the bundle shell\n        // Or, if the product.price_range.minimum_price.final_price.value is a base price, start with that.\n        // This part is highly dependent on how Magento GraphQL reports bundle prices.\n        // Assuming for dynamic, the main product price is a base, and options add to it.\n        // If fixed price, this calculation is not needed as price is static.\n    }\n\n\n    Object.values(selectedBundleOptions).forEach(selection => {\n      if (product.price_view === 'PRICE_RANGE') {\n        currentPrice += selection.price * selection.quantity;\n      }\n      // For FIXED price bundles, the price doesn't change with options.\n      // The `product.price_range.minimum_price.final_price.value` is the fixed total.\n    });\n\n    setBundleTotalPrice(currentPrice);\n    if (onBundleSelectionChange) {\n      onBundleSelectionChange(selectedBundleOptions, currentPrice);\n    }\n  }, [selectedBundleOptions, product.price_range.minimum_price.final_price.value, product.price_view, onBundleSelectionChange]);\n\n\n  if (!bundleItems || bundleItems.length === 0) {\n    return <p>This bundle product has no items configured.</p>;\n  }\n\n  return (\n    <div className=\"mt-4 mb-6 space-y-6\">\n      {bundleItems.map(item => (\n        <div key={item.option_id} className=\"border p-4 rounded-md shadow-sm bg-gray-50\">\n          <h4 className=\"text-lg font-semibold text-gray-800 mb-2\">\n            {item.title} {item.required && <span className=\"text-red-500\">*</span>}\n          </h4>\n          {item.options && item.options.length > 0 ? (\n            <div className=\"space-y-3\">\n              {item.type === 'select' || item.type === 'radio' ? (\n                <select\n                  id={`bundle-item-${item.option_id}`}\n                  className=\"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                  value={selectedBundleOptions[item.option_id]?.selection_id || ''}\n                  onChange={(e) => handleOptionChange(item.option_id, parseInt(e.target.value))}\n                  disabled={item.options.length === 1 && item.required}\n                >\n                  {!item.required && <option value=\"\">None</option>}\n                  {item.options.map(opt => (\n                    <option key={opt.id} value={opt.id} disabled={opt.product.stock_status !== 'IN_STOCK'}>\n                      {opt.label}\n                      {opt.product.stock_status !== 'IN_STOCK' && ' (Out of stock)'}\n                      {opt.price > 0 && ` (+${formatPrice(opt.price, product.price_range.minimum_price.final_price.currency)})`}\n                    </option>\n                  ))}\n                </select>\n              ) : item.type === 'checkbox' || item.type === 'multi' ? (\n                item.options.map(opt => (\n                  <div key={opt.id} className=\"flex items-center\">\n                    <input\n                      type=\"checkbox\"\n                      id={`bundle-opt-${opt.id}`}\n                      checked={!!selectedBundleOptions[item.option_id]?.find(s => s.selection_id === opt.id)}\n                      onChange={(e) => {\n                        // This logic needs to be more complex for multi-select\n                        // For now, simplifying: assumes single selection for checkbox for demo\n                        if (e.target.checked) {\n                          handleOptionChange(item.option_id, opt.id, opt.quantity);\n                        } else {\n                          // Logic to remove the option\n                        }\n                      }}\n                      className=\"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500\"\n                      disabled={opt.product.stock_status !== 'IN_STOCK'}\n                    />\n                    <label htmlFor={`bundle-opt-${opt.id}`} className={`ml-2 text-sm ${opt.product.stock_status !== 'IN_STOCK' ? 'text-gray-400 line-through' : 'text-gray-700'}`}>\n                      {opt.label}\n                      {opt.product.stock_status !== 'IN_STOCK' && ' (Out of stock)'}\n                      {opt.price > 0 && ` (+${formatPrice(opt.price, product.price_range.minimum_price.final_price.currency)})`}\n                    </label>\n                  </div>\n                ))\n              ) : (\n                 <p className=\"text-sm text-gray-500\">Unsupported option type: {item.type}</p>\n              )}\n\n              {/* Quantity for the selected option if changeable */}\n              {selectedBundleOptions[item.option_id] && item.options.find(o => o.id === selectedBundleOptions[item.option_id].selection_id)?.can_change_quantity && (\n                <div className=\"mt-2 flex items-center\">\n                  <label htmlFor={`qty-${item.option_id}`} className=\"text-sm font-medium text-gray-700 mr-2\">Quantity:</label>\n                  <input\n                    type=\"number\"\n                    id={`qty-${item.option_id}`}\n                    min={item.required ? 1 : 0} // Or based on specific option min/max\n                    value={selectedBundleOptions[item.option_id]?.quantity || 1}\n                    onChange={(e) => handleQuantityChange(item.option_id, selectedBundleOptions[item.option_id].selection_id, e.target.value)}\n                    className=\"w-20 py-1 px-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n                    disabled={!selectedBundleOptions[item.option_id] || item.options.find(o => o.id === selectedBundleOptions[item.option_id].selection_id)?.product.stock_status !== 'IN_STOCK'}\n                  />\n                </div>\n              )}\n            </div>\n          ) : (\n            <p className=\"text-sm text-gray-500\">No options available for this item.</p>\n          )}\n        </div>\n      ))}\n      {product.price_view === 'PRICE_RANGE' && (\n        <div className=\"mt-6 pt-4 border-t\">\n          <h4 className=\"text-xl font-semibold text-gray-800\">\n            Bundle Price: {formatPrice(bundleTotalPrice, product.price_range.minimum_price.final_price.currency)}\n          </h4>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(BundleProductOptions);"],"names":["memo","product","onBundleSelectionChange","items","bundleItems","selectedBundleOptions","setSelectedBundleOptions","useState","bundleTotalPrice","setBundleTotalPrice","price_range","minimum_price","final_price","value","useEffect","initialSelections","initialPrice","parseFloat","forEach","item","options","length","defaultOption","find","opt","is_default","option_id","selection_id","id","quantity","price","product_id","sku","price_view","handleOptionChange","itemOptionId","selectionId","prev","newSelections","selectedOpt","i","o","currentPrice","Object","values","selection","jsxs","className","children","map","title","required","jsx","jsxRuntimeExports","type","_a","onChange","e","parseInt","target","disabled","stock_status","label","formatPrice","currency","checked","s","htmlFor","_b","can_change_quantity","min","_c","newQuantity","qty","handleQuantityChange","_d"],"mappings":"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"}