import{r as e,j as t}from"./vendor-frSDhvcu.js";import{u as r}from"./useProduct-BzMN_9cj.js";import{h as a,j as s,k as l,m as o,n as c,o as i,p as n,q as d,r as u,s as g,t as m,e as y}from"./index-CvpdAI6N.js";import{P as h}from"./ProductFilter-D1eJOwrX.js";import{P as p}from"./ProductCard-CVF2HPGq.js";import{S as f}from"./seo-D9cx9PBx.js";import{c as x,L as C}from"./vendor-router-CdLpK7Hz.js";import"./vendor-apollo-CIbFPnud.js";import"./LoginWrapper-BvE8Zoxs.js";function j(){const{slug:j}=x(),{getProductsByCategory:b,getProductFilters:v,contextError:w}=r(),{currentCategory:S,loadCategoryByUrlKey:k,getCategoryBreadcrumbs:F,loading:N,error:P}=(()=>{const[t,r]=e.useState([]),[y,h]=e.useState(null),[p,f]=e.useState(null),[x,C]=e.useState(null),[j,b]=e.useState({items:[],total_count:0}),[v,w]=e.useState([]),[S,k]=e.useState({}),[F,N]=e.useState({}),P=e.useRef({categories:t,categoryTree:y,error:p,currentCategory:x,categoryProducts:j,productFilters:v,cachedCategoryDetails:S,cachedBreadcrumbs:F});return P.current={categories:t,categoryTree:y,error:p,currentCategory:x,categoryProducts:j,productFilters:v,cachedCategoryDetails:S,cachedBreadcrumbs:F},{categories:t,categoryTree:y,error:p,currentCategory:x,categoryProducts:j,productFilters:v,loadCategories:e.useCallback((async()=>{f(null);try{const e=(await a()).items||[];return r(e),e}catch(e){return f(e.message||"Failed to load categories"),[]}}),[]),loadCategoryTree:e.useCallback((async(e=2)=>{f(null);try{const t=await s(e);return h(t),t}catch(t){return f(t.message||"Failed to load category tree"),null}}),[]),loadCategoryById:e.useCallback((async e=>{f(null);try{const t=await l(e);return C(t),t}catch(t){return f(t.message||`Failed to load category ${e}`),null}}),[]),loadCategoryByUrlKey:e.useCallback((async e=>{if(f(null),P.current.cachedCategoryDetails[e]){const t=P.current.cachedCategoryDetails[e];return C(t),t}try{const t=await o(e);return t?(k((r=>({...r,[e]:t}))),C(t)):C(null),t}catch(t){return f(t.message||`Failed to load category ${e}`),C(null),null}}),[k,C,,f]),loadCategoryProducts:e.useCallback((async(e,t={})=>{f(null);try{let r;return r="number"==typeof e?await c(e,t):await i(e,t),b(r),r}catch(r){return f(r.message||`Failed to load products for category ${e}`),{items:[],total_count:0}}}),[]),loadChildCategories:e.useCallback((async e=>{f(null);try{return(await n(e)).items||[]}catch(t){return f(t.message||`Failed to load child categories for ${e}`),[]}}),[]),loadCategoryFilters:e.useCallback((async e=>{f(null);try{const t=await d(e);return w(t),t}catch(t){return f(t.message||`Failed to load filters for category ${e}`),[]}}),[]),loadFeaturedCategories:e.useCallback((async(e=10)=>{f(null);try{return(await u(e)).items||[]}catch(t){return f(t.message||"Failed to load featured categories"),[]}}),[]),searchCategoriesByName:e.useCallback((async(e,t=20)=>{f(null);try{return(await g(e,t)).items||[]}catch(r){return f(r.message||`Failed to search categories for "${e}"`),[]}}),[]),getCategoryBreadcrumbs:e.useCallback((async e=>{if(f(null),P.current.cachedBreadcrumbs[e])return P.current.cachedBreadcrumbs[e];try{const t=(await m(e)).map((e=>({id:e.id,name:e.name,url:`/category/${e.url_key||e.id}`})));return t.length>0&&N((r=>({...r,[e]:t}))),t}catch(t){return f(t.message||`Failed to get breadcrumbs for category ${e}`),[]}}),[N,f]),clearError:e.useCallback((()=>f(null)),[])}})(),[B,$]=e.useState([]),[_,T]=e.useState([]),[D,E]=e.useState({}),[U,A]=e.useState([]),[L,M]=e.useState([]),[R,I]=e.useState("position"),[K,q]=e.useState("ASC"),[z,G]=e.useState(1),[O]=e.useState(12),[W,Y]=e.useState(0),[H,J]=e.useState(!0),[Q,V]=e.useState(!1);e.useEffect((()=>{(async()=>{if(j)try{V(!0);const e=await k(j);if(!(null==e?void 0:e.id))return;const[t,r]=await Promise.all([v(e.id),F(e.id)]);T(t||[]),A(r||[]),M(e.children_data||[])}catch(e){}finally{V(!1)}})()}),[j,k,v,F]),e.useEffect((()=>{$([]),G(1),J(!0),E({})}),[j]);const X=e.useMemo((()=>Object.entries(D).filter((([,e])=>e.length>0)).map((([e,t])=>{if("price"===e){if(t.length>0){const e=t[0],[r,a]=e.split("_"),s={field:"price"};return r&&"*"!==r&&(s.from=r),a&&"*"!==a&&(s.to=a),{filters:[s]}}return null}return{filters:t.map((t=>({field:e,value:t,condition_type:"in"})))}})).filter((e=>null!==e))),[D]),Z=e.useCallback((async()=>{if(null==S?void 0:S.id)try{V(!0);const e={currentPage:z,pageSize:O,sortField:R,sortDirection:K,filterGroups:X},t=await b(S.id,e);(null==t?void 0:t.items)&&($((e=>1===z?t.items:[...e,...t.items])),Y(t.total_count||0),J(z<Math.ceil((t.total_count||0)/O)))}catch(e){}finally{V(!1)}}),[S,z,O,R,K,X,b]);e.useEffect((()=>{const e=setTimeout((()=>{Z()}),100);return()=>clearTimeout(e)}),[Z]);const ee=e.useCallback(((e,t)=>{E((r=>({...r,[e]:t.length?t:void 0}))),G(1)}),[]);e.useCallback((e=>{const t=e.target.value;if(t.includes("_")){const[e,r]=t.split("_");I(e),q(r.toUpperCase())}else I(t),q("ASC");G(1)}),[]),e.useCallback((e=>{G(e),window.scrollTo(0,0)}),[]);const te=!S&&(N||Q),re=w||P;if(te)return t.jsx(y,{});if(re&&!S)return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[t.jsx("p",{children:re.message||"An error occurred loading category details."}),t.jsx(C,{to:"/",className:"text-indigo-600 hover:underline mt-2 inline-block",children:"Return to homepage"})]})});if(!S&&!te)return t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:[t.jsx("p",{children:"Category not found."}),t.jsx(C,{to:"/",className:"text-indigo-600 hover:underline mt-2 inline-block",children:"Return to homepage"})]})});const ae=Math.ceil(W/O);return t.jsxs(t.Fragment,{children:[t.jsx(f,{title:(null==S?void 0:S.name)||"Category Products",description:(null==S?void 0:S.description)||"Browse products in this category.",keywords:(null==S?void 0:S.meta_keywords)||"",ogTitle:(null==S?void 0:S.name)||"Category Products",ogDescription:(null==S?void 0:S.description)||"Browse products in this category.",ogImage:(null==S?void 0:S.image)||"",ogUrl:`${window.location.origin}${location.pathname}`}),t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[t.jsx("aside",{className:"w-full md:w-1/4",children:_.length>0&&t.jsx(h,{filters:_,appliedFilters:D,onFilterChange:ee})}),t.jsxs("main",{className:"w-full md:w-3/4",children:[Q&&0===B.length?t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(y,{})}):re&&0===B.length?t.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:t.jsx("p",{children:re.message||"Could not load products."})}):B.length>0?t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:B.map(((e,r)=>t.jsx(p,{product:e,isLCPCandidate:0===r&&1===z},e.id||`product-${r}`)))}):t.jsx("div",{className:"bg-gray-100 p-8 text-center rounded-lg",children:t.jsx("p",{className:"text-gray-600",children:"No products found matching your criteria."})}),Q&&B.length>0&&t.jsx("div",{className:"flex justify-center my-8",children:t.jsx(y,{})}),!Q&&!H&&B.length>0&&t.jsx("p",{className:"text-center text-gray-500 my-8",children:"You've reached the end of the results."}),ae>1&&t.jsx("div",{className:"mt-8 flex justify-center"})]})]})})]})}export{j as default};
//# sourceMappingURL=CategoryPage-Di-oEDKW.js.map
