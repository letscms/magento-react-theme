{"version":3,"file":"AddToCartButton-zjaWqJYP.js","sources":["../../../src/components/cart/AddToCartButton.jsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport { useCart } from \"../../hooks/useCart\";\nimport { useNavigate } from \"react-router-dom\";\nimport { toast } from \"react-toastify\";\nimport Swal from \"sweetalert2\";\nimport { isAuthenticated } from \"../../api/auth\";\nimport { createRoot } from \"react-dom/client\";\nimport LoginWrapper from \"../forms/LoginWrapper\";\n\nconst AddToCartButton = ({\n  product,\n  quantity,\n  className = \"bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800 transition\",\n  showQuantity = false,\n  buttonText = \"Add to Cart\",\n  onSuccess = () => {},\n  onError = () => {},\n  selectedOptions,\n  bundleSelections,\n  groupedItemsQuantities,\n}) => {\n  const { addItemToCart, loading } = useCart();\n  // const [itemQuantity, setItemQuantity] = useState(quantity);\n  const itemQuantity =quantity;\n  const [addingToCart, setAddingToCart] = useState(false);\n  const user = isAuthenticated();\n\n  const navigate = useNavigate();\n\n  const isLoading = loading || addingToCart;\n  const buttonClasses = `${className} ${\n    isLoading ? \"opacity-70 cursor-not-allowed\" : \"\"\n  }`;\n\n  const handleQuantityChange = (e) => {\n    const value = parseInt(e.target.value);\n    if (value > 0) setItemQuantity(value);\n  };\n\n  const navigateIfProductEmpty = (product) => {\n    if (!product) return;\n\n    const typeChecks = {\n      DownloadableProduct: !product.downloadable_product_links?.length,\n      BundleProduct: !product.bundle_options?.length,\n      GroupedProduct: !product.items?.length,\n      ConfigurableProduct: !product.configurable_options?.length,\n    };\n\n    if (typeChecks[product.__typename]) {\n      navigate(`/product/${product.url_key}`);\n      return true;\n    }\n\n    return false;\n  };\n\n  const buildCartItemPayload = () => {\n    const { type_id, sku, name, price_range, small_image } = product;\n    const basePayload = {\n      sku,\n      qty: itemQuantity,\n      name: name || \"Product\",\n      price: price_range?.minimum_price?.final_price?.value || 0,\n      image: small_image?.url || \"\",\n    };\n\n    switch (type_id) {\n      case \"configurable\":\n        if (!selectedOptions) return null;\n        return {\n          ...basePayload,\n          product_option: {\n            extension_attributes: {\n              configurable_item_options: Object.entries(selectedOptions).map(\n                ([id, value]) => ({\n                  option_id: String(id),\n                  option_value: Number(value),\n                })\n              ),\n            },\n          },\n        };\n\n      case \"bundle\":\n        if (!bundleSelections) return null;\n        return {\n          ...basePayload,\n          product_option: {\n            extension_attributes: {\n              bundle_options: Object.values(bundleSelections).map((sel) => ({\n                option_id: sel.option_id,\n                option_qty: sel.quantity,\n                option_selections: [sel.selection_id],\n              })),\n            },\n          },\n        };\n\n      case \"grouped\":\n        if (!groupedItemsQuantities) return null;\n        return {\n          ...basePayload,\n          qty: 1,\n          extension_attributes: {\n            grouped_items: Object.entries(groupedItemsQuantities)\n              .filter(([, qty]) => qty > 0)\n              .map(([sku, qty]) => ({ sku, qty })),\n          },\n        };\n\n      default:\n        return basePayload;\n    }\n  };\n\n  const showLoginPopup = async () => {\n    const container = document.createElement(\"div\");\n    const root = createRoot(container);\n\n    root.render(<LoginWrapper />);\n\n    const result = await Swal.fire({\n      html: container,\n      showConfirmButton: false,\n      showCloseButton: true,\n      customClass: {\n        container: \"login-popup-container\",\n        popup: \"login-popup\",\n      },\n      width: \"500px\",\n      didDestroy: () => {\n        root.unmount();\n      },\n    });\n\n    return result.isConfirmed;\n  };\n\n  const handleAddToCart = async () => {\n    if (!product || !product.sku) return;\n\n    if (!user) {\n      const loginResult = await showLoginPopup();\n      if (!loginResult) return; // User cancelled login\n    }\n\n    if (product.stock_status !== \"IN_STOCK\") {\n      toast.error(`${product.name} is out of stock.`);\n      return navigate(`/product/${product.url_key}`);\n    }\n\n    if (navigateIfProductEmpty(product)) return;\n\n    try {\n      setAddingToCart(true);\n      const cartItemPayload = buildCartItemPayload();\n\n      if (!cartItemPayload) {\n        toast.error(\"Please select required options before adding to cart.\");\n        return;\n      }\n\n      const response = await addItemToCart(cartItemPayload);\n\n      if (response.success) {\n        toast.success(`${product.name} added to cart!`, {\n          position: \"top-right\",\n          autoClose: 3000,\n        });\n        onSuccess(product, itemQuantity);\n      }\n    } catch (error) {\n      console.error(\"Failed to add to cart:\", error);\n      toast.error(`Failed to add ${product.name} to cart. Please try again.`, {\n        position: \"top-right\",\n        autoClose: 5000,\n      });\n      onError(error);\n    } finally {\n      setAddingToCart(false);\n    }\n  };\n\n  return (\n    <div >    \n\n      <button\n        type=\"button\"\n        className={buttonClasses}\n        onClick={handleAddToCart}\n        disabled={isLoading}\n      >\n        {isLoading ? (\n          <span className=\"flex items-center justify-center\">\n            <svg\n              className=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\"\n              viewBox=\"0 0 24 24\"\n            >\n              <circle\n                className=\"opacity-25\"\n                cx=\"12\"\n                cy=\"12\"\n                r=\"10\"\n                stroke=\"currentColor\"\n                strokeWidth=\"4\"\n              ></circle>\n              <path\n                className=\"opacity-75\"\n                fill=\"currentColor\"\n                d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n              ></path>\n            </svg>\n            Adding...\n          </span>\n        ) : (\n          buttonText\n        )}\n      </button>\n    </div>\n  );\n};\n\nexport default React.memo(AddToCartButton);\n"],"names":["AddToCartButton$1","React","memo","product","quantity","className","showQuantity","buttonText","onSuccess","onError","selectedOptions","bundleSelections","groupedItemsQuantities","addItemToCart","loading","useCart","itemQuantity","addingToCart","setAddingToCart","useState","user","isAuthenticated","navigate","useNavigate","isLoading","buttonClasses","children","jsxRuntimeExports","jsx","type","onClick","async","sku","container","document","createElement","root","createRoot","render","LoginWrapper","Swal","fire","html","showConfirmButton","showCloseButton","customClass","popup","width","didDestroy","unmount","isConfirmed","showLoginPopup","stock_status","toast","error","name","url_key","DownloadableProduct","product2","downloadable_product_links","_a","length","BundleProduct","bundle_options","_b","GroupedProduct","items","_c","ConfigurableProduct","configurable_options","_d","__typename","navigateIfProductEmpty","cartItemPayload","type_id","price_range","small_image","basePayload","qty","price","minimum_price","final_price","value","image","url","product_option","extension_attributes","configurable_item_options","Object","entries","map","id","option_id","String","option_value","Number","values","sel","option_qty","option_selections","selection_id","grouped_items","filter","buildCartItemPayload","success","position","autoClose","disabled","jsxs","viewBox","cx","cy","r","stroke","strokeWidth","fill","d"],"mappings":"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"}