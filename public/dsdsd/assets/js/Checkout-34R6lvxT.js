import{r as e,j as s}from"./vendor-frSDhvcu.js";import{w as t,x as a,a as n,y as i,z as r,L as l,f as d,A as o,B as c,v as m}from"./index-CvpdAI6N.js";import{L as u,u as h}from"./vendor-router-CdLpK7Hz.js";import"./vendor-apollo-CIbFPnud.js";const p=e=>{if(!e)throw new Error("Cart ID is required for guest checkout")},g=async(e,s)=>{var t;try{if(p(e),!(null==s?void 0:s.method))throw new Error("Payment method is required");if(!s.email)throw new Error("Email is required for guest checkout");const t={paymentMethod:{method:s.method,...s.additional_data&&{additional_data:s.additional_data}},email:s.email};return(await a.put(`/guest-carts/${e}/order`,t,{headers:{"Content-Type":"application/json",Accept:"application/json"}})).data}catch(n){let e="Failed to place order";throw n.response&&(404===n.response.status?e="Cart not found or expired.":(null==(t=n.response.data)?void 0:t.message)&&(e=n.response.data.message)),new Error(e)}},x=async(e=null)=>{try{const s=t.isAuthenticated();s||p(e);const n=s?"/carts/mine/payment-methods":`/guest-carts/${e}/payment-methods`;return(await a.get(n)).data}catch(s){throw new Error("Failed to fetch payment methods")}},b=async(e,s,n=null)=>{var i,r;try{const i=t.isAuthenticated();i||p(n);const r={firstname:e.firstname,lastname:e.lastname,street:e.street,city:e.city,region:e.region,postcode:e.postcode,country_id:e.country_id,telephone:e.telephone,email:e.email,...e.region_id&&{region_id:parseInt(e.region_id,10)}},l={addressInformation:{shipping_address:r,billing_address:e.same_as_billing?{...r}:{firstname:e.billing_address.firstname,lastname:e.billing_address.lastname,street:e.billing_address.street,city:e.billing_address.city,region:e.billing_address.region,postcode:e.billing_address.postcode,country_id:e.billing_address.country_id,telephone:e.billing_address.telephone,email:e.billing_address.email,...e.billing_address.region_id&&{region_id:parseInt(e.billing_address.region_id,10)}},shipping_method_code:s.method_code,shipping_carrier_code:s.carrier_code}},d=i?"/carts/mine/shipping-information":`/guest-carts/${n}/shipping-information`;return(await a.post(d,l)).data}catch(l){throw new Error((null==(r=null==(i=l.response)?void 0:i.data)?void 0:r.message)||"Failed to set shipping information")}},y=async(e,s=null)=>{var n,i;try{const n=t.isAuthenticated();n||p(s);const i={paymentMethod:{method:e.method,...e.additional_data&&{additional_data:e.additional_data}}};if(!n)return await g(s,e);try{return(await a.post("/carts/mine/payment-information",i)).data}catch(r){return(await a.post("/carts/mine/order",i)).data}}catch(l){throw new Error((null==(i=null==(n=l.response)?void 0:n.data)?void 0:i.message)||"Failed to place order. Please try again.")}},f=async()=>{try{return(await a.get("/directory/countries")).data}catch(e){throw new Error("Failed to fetch countries list")}},j=async(e,s=null)=>{var n,i;try{const n=t.isAuthenticated();n||p(s);const i={country_id:e.country_id,postcode:e.postcode,region:e.region,...e.region_id&&{region_id:parseInt(e.region_id,10)},...e.city&&{city:e.city}},r=n?"/carts/mine/estimate-shipping-methods":`/guest-carts/${s}/estimate-shipping-methods`;return(await a.post(r,{address:i})).data}catch(r){throw new Error((null==(i=null==(n=r.response)?void 0:n.data)?void 0:i.message)||"Failed to estimate shipping methods")}},v=async(e=null)=>{try{const s=t.isAuthenticated();s||p(e);const n=s?"/carts/mine/totals":`/guest-carts/${e}/totals`;return(await a.get(n)).data}catch(s){throw new Error("Failed to fetch cart totals")}},N=e.memo((({shippingAddress:t,billingAddress:a,handleShippingAddressChange:l,handleBillingAddressChange:d,toggleSameAsBilling:o,countries:c,sectionCompleted:m,sectionExpanded:u,toggleSection:h,saveShippingAddress:p,sectionLoading:g})=>{const[x,b]=e.useState([]),[y,f]=e.useState([]),{currentUser:j,isAuthenticated:v}=n(),{addresses:N,fetchAddresses:_}=i(),[w,C]=e.useState(""),[S,k]=e.useState(!1);e.useEffect((()=>{v()&&_()}),[v,_]),e.useEffect((()=>{if(v())if(N&&N.length>0){k(!1);const e=N.find((e=>e.default_shipping));e?(C(e.id.toString()),l(A(e),null,!0),e.country_id&&F(e.country_id,"shipping")):C("")}else k(!0),C("new");else k(!0),C("new")}),[v,N,l]);const A=e.useCallback((e=>{var s,t;return e?{firstname:e.firstname||"",lastname:e.lastname||"",street:Array.isArray(e.street)?[e.street[0]||"",e.street[1]||""]:[e.street||"",""],city:e.city||"",postcode:e.postcode||"",country_id:e.country_id||"",telephone:e.telephone||"",email:e.email||(null==j?void 0:j.email)||"",region:(null==(s=e.region)?void 0:s.region)||("string"==typeof e.region?e.region:"")||"",region_id:(null==(t=e.region)?void 0:t.region_id)||e.region_id||""}:{}}),[j]),F=e.useCallback((async(e,s)=>{if(!e)return"shipping"===s&&b([]),void("billing"===s&&f([]));try{const t=await r(e);"shipping"===s&&b(t||[]),"billing"===s&&f(t||[])}catch(t){"shipping"===s&&b([]),"billing"===s&&f([])}}),[]),P=e.useCallback((async e=>{if(C(e),k("new"===e),"new"===e){const e=A({email:null==j?void 0:j.email});l(e,null,!0),b([]),t.same_as_billing&&(d(e,null,!0),f([]))}else{const s=N.find((s=>s.id.toString()===e));if(s){const e=A(s);l(e,null,!0),e.country_id&&await F(e.country_id,"shipping"),t.same_as_billing&&(d(e,null,!0),e.country_id&&await F(e.country_id,"billing"))}}}),[N,A,l,d,F,t.same_as_billing,null==j?void 0:j.email]);return e.useCallback((()=>{P("new")}),[P]),s.jsxs("div",{className:"bg-white rounded-lg shadow-md mb-6 overflow-hidden",children:[s.jsxs("div",{className:"p-4 border-b cursor-pointer flex justify-between items-center "+(m.address?"bg-green-50":""),onClick:()=>h("address"),children:[s.jsxs("h2",{className:"text-lg font-semibold",children:[m.address?s.jsx("span",{className:"text-green-600",children:"âœ“ "}):s.jsx("span",{className:"text-gray-400",children:"1. "}),"Shipping Address"]}),s.jsx("svg",{className:"h-5 w-5 transform "+(u.address?"rotate-180":""),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),u.address&&s.jsxs("div",{className:"p-6",children:[v()&&N.length>0&&s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{htmlFor:"saved_address_select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select a Saved Address or Add New"}),s.jsxs("select",{id:"saved_address_select",value:w,onChange:e=>P(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"",children:"--- Select Address ---"}),N.map((e=>{var t;return s.jsx("option",{value:e.id.toString(),children:`${e.firstname} ${e.lastname}, ${e.street.join(", ")}, ${e.city}, ${(null==(t=e.region)?void 0:t.region)||e.region||""} ${e.postcode}, ${e.country_id}`},e.id)})),s.jsx("option",{value:"new",children:"-- Add New Address --"})]})]}),(S||!v()||v()&&0===N.length&&"new"===w)&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"firstname",className:"block text-sm font-medium text-gray-700 mb-1",children:["First Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"firstname",name:"firstname",value:t.firstname,onChange:e=>l("firstname",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"lastname",className:"block text-sm font-medium text-gray-700 mb-1",children:["Last Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"lastname",name:"lastname",value:t.lastname,onChange:e=>l("lastname",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsxs("label",{htmlFor:"street1",className:"block text-sm font-medium text-gray-700 mb-1",children:["Street Address ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"street1",name:"street[0]",value:t.street[0],onChange:e=>l("street",[e.target.value,t.street[1]]),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Street address, P.O. box, company name",required:!0})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsx("input",{type:"text",id:"street2",name:"street[1]",value:t.street[1],onChange:e=>l("street",[t.street[0],e.target.value]),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 mt-2",placeholder:"Apartment, suite, unit, building, floor, etc."})}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"country_id_shipping",className:"block text-sm font-medium text-gray-700 mb-1",children:["Country ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("select",{id:"country_id_shipping",name:"country_id",value:t.country_id,onChange:e=>{l("country_id",e.target.value),F(e.target.value,"shipping")},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:[s.jsx("option",{value:"",children:"Select Country"}),c.map((e=>s.jsx("option",{value:e.id,children:e.full_name_english},e.id)))]})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"region_shipping",className:"block text-sm font-medium text-gray-700 mb-1",children:["State/Province/Region ",s.jsx("span",{className:"text-red-500",children:"*"})]}),0===x.length?s.jsx("input",{id:"region_shipping_text",type:"text",name:"region",value:t.region,onChange:e=>{l("region",e.target.value),l("region_id","")},placeholder:"Enter State/Province/Region",required:!t.country_id||t.country_id&&0===x.length,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):s.jsxs("select",{id:"region_id_shipping_select",name:"region_id",value:t.region_id,onChange:e=>{const s=e.target.value,t=x.find((e=>Number(e.id)===Number(s)));l("region_id",s),l("region",(null==t?void 0:t.name)||"")},required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Select State"}),x.map((e=>s.jsx("option",{value:e.id,children:e.name},e.id)))]})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-1",children:["City ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"city",name:"city",value:t.city,onChange:e=>l("city",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"postcode",className:"block text-sm font-medium text-gray-700 mb-1",children:["Zip/Postal Code ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"postcode",name:"postcode",value:t.postcode,onChange:e=>l("postcode",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"telephone",className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"tel",id:"telephone",name:"telephone",value:t.telephone,onChange:e=>l("telephone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"email_shipping",className:"block text-sm font-medium text-gray-700 mb-1",children:["Email Address ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"email",id:"email_shipping",name:"email",value:t.email,onChange:e=>l("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,readOnly:v()&&(null==j?void 0:j.email)===t.email})]})]}),v()&&s.jsx("div",{className:"mt-4",children:s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",name:"save_in_address_book",checked:!1!==t.save_in_address_book,onChange:e=>l("save_in_address_book",e.target.checked),className:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Save in address book"})]})})]}),s.jsx("div",{className:"mt-6",children:s.jsxs("label",{className:"inline-flex items-center",children:[s.jsx("input",{type:"checkbox",name:"same_as_billing",checked:t.same_as_billing,onChange:o,className:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Billing address same as shipping address"})]})}),!t.same_as_billing&&s.jsxs("div",{className:"mt-6",children:[s.jsx("h3",{className:"text-lg font-medium mb-4",children:"Billing Address"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"billing_firstname",className:"block text-sm font-medium text-gray-700 mb-1",children:["First Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"billing_firstname",name:"billing_firstname",value:a.firstname,onChange:e=>d("firstname",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"billing_lastname",className:"block text-sm font-medium text-gray-700 mb-1",children:["Last Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"billing_lastname",name:"billing_lastname",value:a.lastname,onChange:e=>d("lastname",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsxs("label",{htmlFor:"billing_street1",className:"block text-sm font-medium text-gray-700 mb-1",children:["Street Address ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"billing_street1",name:"billing_street[0]",value:a.street[0],onChange:e=>d("street",[e.target.value,a.street[1]]),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsx("div",{className:"md:col-span-2",children:s.jsx("input",{type:"text",id:"billing_street2",name:"billing_street[1]",value:a.street[1],onChange:e=>d("street",[a.street[0],e.target.value]),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 mt-2"})}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"billing_country_id",className:"block text-sm font-medium text-gray-700 mb-1",children:["Country ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsxs("select",{id:"billing_country_id",name:"billing_country_id",value:a.country_id,onChange:e=>{d("country_id",e.target.value),F(e.target.value,"billing")},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,children:[s.jsx("option",{value:"",children:"Select Country"}),c.map((e=>s.jsx("option",{value:e.id,children:e.full_name_english},e.id)))]})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"billing_region",className:"block text-sm font-medium text-gray-700 mb-1",children:["State/Province/Region ",s.jsx("span",{className:"text-red-500",children:"*"})]}),0===y.length?s.jsx("input",{id:"billing_region_text",type:"text",name:"billing_region",value:a.region,onChange:e=>{d("region",e.target.value),d("region_id","")},placeholder:"Enter State/Province/Region",required:!a.country_id||a.country_id&&0===y.length,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}):s.jsxs("select",{id:"billing_region_id_select",name:"billing_region_id",value:a.region_id,onChange:e=>{const s=e.target.value,t=y.find((e=>Number(e.id)===Number(s)));d("region_id",s),d("region",(null==t?void 0:t.name)||"")},required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"Select State"}),y.map((e=>s.jsx("option",{value:e.id,children:e.name},e.id)))]})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"billing_city",className:"block text-sm font-medium text-gray-700 mb-1",children:["City ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"billing_city",name:"billing_city",value:a.city,onChange:e=>d("city",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"billing_postcode",className:"block text-sm font-medium text-gray-700 mb-1",children:["Zip/Postal Code ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",id:"billing_postcode",name:"billing_postcode",value:a.postcode,onChange:e=>d("postcode",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"billing_telephone",className:"block text-sm font-medium text-gray-700 mb-1",children:["Phone Number ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"tel",id:"billing_telephone",name:"billing_telephone",value:a.telephone,onChange:e=>d("telephone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"billing_email",className:"block text-sm font-medium text-gray-700 mb-1",children:["Email Address ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"email",id:"billing_email",name:"billing_email",value:a.email,onChange:e=>d("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,readOnly:v()&&(null==j?void 0:j.email)===a.email&&t.same_as_billing})]})]})]}),s.jsx("div",{className:"mt-8 flex justify-end",children:s.jsx("button",{type:"button",onClick:p,disabled:g,className:"bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:g?"Saving...":"Continue to Shipping"})})]})]})})),_=e.memo((({shippingMethods:e,selectedShippingMethod:t,setSelectedShippingMethod:a,sectionCompleted:n,sectionExpanded:i,toggleSection:r,saveShippingMethod:o,sectionLoading:c})=>s.jsxs("div",{className:"bg-white rounded-lg shadow-md mb-6 overflow-hidden",children:[s.jsxs("div",{className:`p-4 border-b cursor-pointer flex justify-between items-center ${n.shipping?"bg-green-50":""} ${n.address?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>n.address&&r("shipping"),children:[s.jsxs("h2",{className:"text-lg font-semibold",children:[n.shipping?s.jsx("span",{className:"text-green-600",children:"âœ“ "}):s.jsx("span",{className:"text-gray-400",children:"2. "}),"Shipping Method"]}),s.jsx("svg",{className:"h-5 w-5 transform "+(i.shipping?"rotate-180":""),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),i.shipping&&n.address&&s.jsx("div",{className:"p-6",children:c?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(l,{})}):s.jsxs(s.Fragment,{children:[e&&0!==e.length?s.jsx("div",{className:"space-y-3",children:e.map((e=>s.jsxs("div",{className:"flex items-center p-3 border rounded-md hover:bg-gray-50 transition-colors",children:[s.jsx("input",{type:"radio",id:`${e.carrier_code}_${e.method_code}`,name:"shipping_method",checked:t&&t.carrier_code===e.carrier_code&&t.method_code===e.method_code,onChange:()=>a(e),className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500 cursor-pointer"}),s.jsxs("label",{htmlFor:`${e.carrier_code}_${e.method_code}`,className:"ml-3 flex flex-1 justify-between cursor-pointer",children:[s.jsxs("div",{children:[s.jsx("span",{className:"block text-sm font-medium text-gray-700",children:e.carrier_title}),s.jsx("span",{className:"block text-sm text-gray-500",children:e.method_title})]}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.amount?d(e.amount):e.price_incl_tax?d(e.price_incl_tax):"N/A"})]})]},`${e.carrier_code}_${e.method_code}`)))}):s.jsx("p",{className:"text-gray-500 italic",children:"No shipping methods available for your address, or address not yet provided."}),e&&e.length>0&&s.jsx("div",{className:"mt-6",children:s.jsx("button",{type:"button",onClick:o,disabled:c||!t,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",children:c?"Processing...":"Continue to Payment"})})]})})]}))),w=e.memo((({paymentMethods:e,selectedPaymentMethod:t,setSelectedPaymentMethod:a,sectionCompleted:n,sectionExpanded:i,toggleSection:r,savePaymentMethod:d,sectionLoading:o})=>s.jsxs("div",{className:"bg-white rounded-lg shadow-md mb-6 overflow-hidden",children:[s.jsxs("div",{className:`p-4 border-b cursor-pointer flex justify-between items-center ${n.payment?"bg-green-50":""} ${n.shipping?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>n.shipping&&r("payment"),children:[s.jsxs("h2",{className:"text-lg font-semibold",children:[n.payment?s.jsx("span",{className:"text-green-600",children:"âœ“ "}):s.jsx("span",{className:"text-gray-400",children:"3. "}),"Payment Method"]}),s.jsx("svg",{className:"h-5 w-5 transform "+(i.payment?"rotate-180":""),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),i.payment&&n.shipping&&s.jsx("div",{className:"p-6",children:o?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(l,{})}):s.jsxs(s.Fragment,{children:[e&&0!==e.length?s.jsx("div",{className:"space-y-4",children:e.map((e=>s.jsxs("div",{className:"border rounded-md p-4 hover:border-blue-500 transition-colors cursor-pointer",onClick:()=>a(e),children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"radio",id:e.code,name:"payment_method",checked:t&&t.code===e.code,onChange:()=>a(e),className:"h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500 cursor-pointer"}),s.jsx("label",{htmlFor:e.code,className:"ml-3 flex flex-1 cursor-pointer",children:s.jsxs("div",{children:[s.jsx("span",{className:"block text-sm font-medium text-gray-700",children:e.title}),"checkmo"===e.code&&s.jsx("span",{className:"block text-xs text-gray-500 mt-1",children:"Pay by Check or Money Order."}),"cashondelivery"===e.code&&s.jsx("span",{className:"block text-xs text-gray-500 mt-1",children:"Pay on delivery."})]})})]}),t&&t.code===e.code&&"braintree_cc_vault"===e.code&&s.jsxs("div",{className:"mt-4 ml-7 text-sm text-gray-600",children:[s.jsx("p",{className:"italic",children:"Braintree credit card form would appear here."}),s.jsxs("div",{className:"mt-2 space-y-2",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"braintree_card_number",className:"text-xs",children:"Card Number"}),s.jsx("input",{type:"text",id:"braintree_card_number",className:"w-full p-1 border rounded-sm text-xs",placeholder:"â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"braintree_expiry",className:"text-xs",children:"Expiry"}),s.jsx("input",{type:"text",id:"braintree_expiry",className:"w-full p-1 border rounded-sm text-xs",placeholder:"MM/YY"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"braintree_cvv",className:"text-xs",children:"CVV"}),s.jsx("input",{type:"text",id:"braintree_cvv",className:"w-full p-1 border rounded-sm text-xs",placeholder:"â€¢â€¢â€¢"})]})]})]})]},e.code)))}):s.jsx("p",{className:"text-gray-500 italic",children:"No payment methods available. Please ensure shipping is completed."}),e&&e.length>0&&s.jsx("div",{className:"mt-6",children:s.jsx("button",{type:"button",onClick:d,disabled:o||!t,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50",children:o?"Processing...":"Continue to Review Order"})})]})})]}))),C=e.memo((({shippingAddress:t,billingAddress:a,selectedShippingMethod:n,selectedPaymentMethod:i,cartItems:r,orderSummary:m,sectionCompleted:u,sectionExpanded:h,toggleSection:p,placeOrder:g,sectionLoading:x,onCouponApplied:b,onCouponRemoved:y})=>{const[f,j]=e.useState(""),[v,N]=e.useState(!1),[_,w]=e.useState(""),[C,S]=e.useState(""),k=e.useCallback((e=>{if(!e)return"No address provided";return[`${e.firstname} ${e.lastname}`,e.street.filter(Boolean).join(", "),`${e.city}, ${e.region||""} ${e.postcode}`.replace(" ,",",").trim(),e.country_id,e.telephone?`Tel: ${e.telephone}`:null].filter(Boolean).join("; ")}),[]),A=e.useCallback((async()=>{var e,s;if(f.trim()){N(!0),w(""),S("");try{const e=await o(f);e.success?(S("Coupon applied successfully!"),setTimeout((()=>S("")),3e3),j(""),b&&await b()):w(e.message||"Failed to apply coupon.")}catch(t){w((null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"The coupon code isn't valid. Verify the code and try again.")}finally{N(!1)}}}),[f,b]),F=e.useCallback((async()=>{var e,s;N(!0),w(""),S("");try{const e=await c();e.success?(S("Coupon removed successfully!"),setTimeout((()=>S("")),3e3),y?await y():b&&await b()):w(e.message||"Failed to remove coupon.")}catch(t){w((null==(s=null==(e=t.response)?void 0:e.data)?void 0:s.message)||"Failed to remove coupon. Please try again.")}finally{N(!1)}}),[b,y]);return s.jsxs("div",{className:"bg-white rounded-lg shadow-md mb-6 overflow-hidden",children:[s.jsxs("div",{className:`p-4 border-b cursor-pointer flex justify-between items-center ${u.review?"bg-green-50":""} ${u.payment?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>u.payment&&p("review"),children:[s.jsxs("h2",{className:"text-lg font-semibold",children:[u.review?s.jsx("span",{className:"text-green-600",children:"âœ“ "}):s.jsx("span",{className:"text-gray-400",children:"4. "}),"Review & Place Order"]}),s.jsx("svg",{className:"h-5 w-5 transform "+(h.review?"rotate-180":""),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),h.review&&u.payment&&s.jsx("div",{className:"p-6",children:x?s.jsx("div",{className:"flex justify-center py-8",children:s.jsx(l,{})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-md font-medium mb-2",children:"Shipping Information"}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-md text-sm",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Address:"})," ",k(t)]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Method:"})," ",n?`${n.carrier_title} - ${n.method_title} (${d(n.amount||n.price_incl_tax||0)})`:"Not selected"]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-md font-medium mb-2",children:"Billing Information"}),s.jsxs("div",{className:"bg-gray-50 p-4 rounded-md text-sm",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Address:"})," ",t.same_as_billing?"Same as shipping":k(a)]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Payment Method:"})," ",i?i.title:"Not selected"]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-md font-medium mb-2",children:"Order Items"}),s.jsx("div",{className:"bg-gray-50 p-4 rounded-md",children:s.jsx("div",{className:"divide-y divide-gray-200",children:r&&r.map((e=>{var t;return s.jsxs("div",{className:"py-3 flex items-center",children:[s.jsx("div",{className:"w-16 h-16 flex-shrink-0 overflow-hidden rounded border border-gray-200",children:(null==(t=e.extension_attributes)?void 0:t.image_url)?s.jsx("img",{src:e.extension_attributes.image_url,alt:e.name,className:"w-full h-full object-cover",loading:"lazy"}):s.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:s.jsx("span",{className:"text-xs text-gray-500",children:"No image"})})}),s.jsxs("div",{className:"ml-4 flex-1",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900",children:e.name}),s.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",e.sku]}),s.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",e.qty]})]}),s.jsx("div",{className:"text-sm font-medium text-gray-900",children:d(e.price*e.qty)})]},e.item_id||e.sku)}))})})]}),m&&s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-md font-medium mb-2",children:"Order Summary"}),s.jsx("div",{className:"bg-gray-50 p-4 rounded-md",children:s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Subtotal"}),s.jsx("span",{className:"font-medium",children:d(m.subtotal_with_discount||m.subtotal||0)})]}),0!==m.discount_amount&&s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-green-600",children:["Discount (",m.coupon_code||"Auto",")"]}),s.jsxs("span",{className:"font-medium text-green-600",children:["-",d(Math.abs(m.discount_amount))]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{children:["Shipping (",(null==n?void 0:n.method_title)||"N/A",")"]}),s.jsx("span",{className:"font-medium",children:d(m.shipping_amount||0)})]}),m.tax_amount>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:"Tax"}),s.jsx("span",{className:"font-medium",children:d(m.tax_amount)})]}),s.jsx("div",{className:"border-t pt-2 mt-2",children:s.jsxs("div",{className:"flex justify-between text-base",children:[s.jsx("span",{className:"font-semibold",children:"Grand Total"}),s.jsx("span",{className:"font-bold",children:d(m.grand_total||0)})]})})]})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-md font-medium mb-2",children:"Coupon Code"}),(null==m?void 0:m.coupon_code)?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-green-700 font-semibold",children:["Applied: ",m.coupon_code]}),s.jsx("button",{type:"button",onClick:F,className:"bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-xs",disabled:v,children:v?"Removing...":"Remove"})]}):s.jsxs("div",{children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:f,onChange:e=>j(e.target.value.toUpperCase()),placeholder:"Enter coupon code",className:"flex-1 border rounded-md px-3 py-2 text-sm focus:ring focus:ring-blue-300"}),s.jsx("button",{type:"button",onClick:A,disabled:v||!f.trim(),className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 text-sm",children:v?"Applying...":"Apply"})]}),C&&s.jsx("p",{className:"text-sm text-green-600 mt-2",children:C}),_&&s.jsx("p",{className:"text-sm text-red-600 mt-2",children:_})]})]}),s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"bg-gray-50 p-4 rounded-md",children:s.jsxs("p",{className:"text-xs text-gray-600",children:["By placing your order, you agree to our"," ",s.jsx("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Terms and Conditions"})," and"," ",s.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Privacy Policy"}),"."]})})}),s.jsx("div",{className:"mt-6",children:s.jsx("button",{type:"button",onClick:g,disabled:x||!i||!n||0===r.length,className:"w-full bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 font-semibold",children:x?"Processing Order...":"Place Order"})})]})})]})})),S=({orderId:e})=>s.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[s.jsx("div",{className:"p-4 border-b bg-green-50",children:s.jsxs("h2",{className:"text-lg font-semibold text-green-600",children:[s.jsx("span",{className:"text-green-600",children:"âœ“ "}),"Order Confirmation"]})}),s.jsxs("div",{className:"p-6 text-center",children:[s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100",children:s.jsx("svg",{className:"h-8 w-8 text-green-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Thank You for Your Order!"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Your order has been placed successfully. We've sent a confirmation email with all the details."}),e&&s.jsxs("div",{className:"mb-6",children:[s.jsxs("p",{className:"text-gray-700",children:["Your order number is: ",s.jsx("span",{className:"font-semibold",children:e})]}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Please keep this number for your reference."})]}),s.jsxs("div",{className:"mt-8 space-y-4",children:[s.jsx("p",{className:"text-gray-600",children:"You can track your order status in your account dashboard."}),s.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:[s.jsx(u,{to:"/account/orders",className:"inline-flex items-center justify-center px-6 py-3 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"View Order"}),s.jsx(u,{to:"/",className:"inline-flex items-center justify-center px-6 py-3 border border-gray-300 rounded-md shadow-sm text-base font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Continue Shopping"})]})]})]})]}),k=e.memo((({cartItems:e,orderSummary:t,selectedShippingMethod:a})=>{const n=Array.isArray(e)?e:[];return s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 sticky top-6",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Order Summary"}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:["Items (",n.length,")"]}),n.length>0?s.jsxs("div",{className:"space-y-3 max-h-60 overflow-y-auto pr-2",children:[" ",n.map((e=>{var t;return s.jsxs("div",{className:"flex items-center py-2",children:[" ",s.jsx("div",{className:"w-12 h-12 flex-shrink-0 overflow-hidden rounded border border-gray-200",children:(null==(t=e.extension_attributes)?void 0:t.image_url)?s.jsx("img",{src:e.extension_attributes.image_url,alt:e.name,className:"w-full h-full object-cover",loading:"lazy"}):s.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:s.jsx("span",{className:"text-xs text-gray-500",children:"No image"})})}),s.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[" ",s.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:e.name,children:e.name}),s.jsxs("p",{className:"text-xs text-gray-500",children:["Qty: ",e.qty]})]}),s.jsxs("div",{className:"text-sm font-medium text-gray-900 ml-2",children:[" ",d((e.price||0)*(e.qty||0))]})]},e.item_id||e.sku)}))]}):s.jsx("p",{className:"text-sm text-gray-500 italic",children:"Your cart is empty."})]}),t&&s.jsxs("div",{className:"border-t pt-4 space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Subtotal"}),s.jsx("span",{className:"font-medium",children:d(t.subtotal_with_discount||t.subtotal||0)})]}),t.discount_amount<0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-gray-600",children:["Discount (",t.coupon_code||"Auto",")"]}),s.jsx("span",{className:"font-medium text-green-600",children:d(t.discount_amount)})]}),"number"==typeof t.shipping_amount&&s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("span",{className:"text-gray-600",children:["Shipping ",a?`(${a.method_title||a.carrier_title})`:""]}),s.jsx("span",{className:"font-medium",children:d(t.shipping_amount)})]}),t.tax_amount>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Tax"}),s.jsx("span",{className:"font-medium",children:d(t.tax_amount)})]}),s.jsxs("div",{className:"flex justify-between border-t pt-2 mt-2",children:[s.jsx("span",{className:"font-semibold text-base",children:"Grand Total"}),s.jsx("span",{className:"font-bold text-lg",children:d(t.grand_total||0)})]})]}),s.jsx("div",{className:"mt-6",children:s.jsxs(u,{to:"/cart",className:"text-blue-600 hover:text-blue-800 text-sm flex items-center group",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1 transition-transform group-hover:-translate-x-1",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Edit Cart"]})})]})})),A=()=>{const a=h(),{cart:n,cartItems:i,getCartItemCount:r,clearCart:d}=m(),[o,c]=e.useState(!0),[u,p]=e.useState(null),[g,A]=e.useState({address:!0,shipping:!1,payment:!1,review:!1}),[F,P]=e.useState({address:!1,shipping:!1,payment:!1,review:!1}),[M,E]=e.useState({address:!1,shipping:!1,payment:!1,review:!1}),[$,q]=e.useState({firstname:"",lastname:"",street:["",""],city:"",region:"",region_id:"",postcode:"",country_id:"US",telephone:"",email:"",save_in_address_book:!0,same_as_billing:!0}),[I,L]=e.useState({firstname:"",lastname:"",street:["",""],city:"",region:"",region_id:"",postcode:"",country_id:"US",telephone:"",email:""}),[R,B]=e.useState([]),[O,T]=e.useState(null),[z,Y]=e.useState([]),[U,D]=e.useState(null),[V,G]=e.useState([]),[H,Q]=e.useState(null),[W,Z]=e.useState(null),K=!t.isAuthenticated(),J=K?localStorage.getItem("magento_guest_cart_id"):null;e.useEffect((()=>{(async()=>{var e,s,n;c(!0),p(null);try{if(0===r()&&!W)return void a("/cart");const l=await f();if(G(l),t.isAuthenticated()){const a=t.getUserInfo();if(a){const t=(null==(e=a.addresses)?void 0:e.find((e=>e.default_shipping)))||(a.addresses&&a.addresses.length>0?a.addresses[0]:null),i={firstname:a.firstname||"",lastname:a.lastname||"",email:a.email||"",telephone:(null==t?void 0:t.telephone)||"",street:(null==t?void 0:t.street)||["",""],city:(null==t?void 0:t.city)||"",region:(null==(s=null==t?void 0:t.region)?void 0:s.region)||("string"==typeof(null==t?void 0:t.region)?t.region:"")||"",region_id:(null==(n=null==t?void 0:t.region)?void 0:n.region_id)||(null==t?void 0:t.region_id)||"",postcode:(null==t?void 0:t.postcode)||"",country_id:(null==t?void 0:t.country_id)||"US",same_as_billing:!0,save_in_address_book:!0};q(i),L(i)}}if(K&&!J&&!W)throw new Error("No guest cart ID found. Please add items to your cart first.");if(i.length>0){const e=await v(J);Q(e)}}catch(l){p(l.message||"Failed to initialize checkout. Please try again.")}finally{c(!1)}})()}),[a,r,J,K,W,i.length]);const X=e.useCallback((e=>{A((s=>{const t={address:!1,shipping:!1,payment:!1,review:!1};if("address"===e||"shipping"===e&&F.address||"payment"===e&&F.shipping||"review"===e&&F.payment)t[e]=!s[e];else{if(!s[e])return s;t[e]=!1}return t}))}),[F]),ee=e.useCallback(((e,s,t=!1)=>{q((a=>{let n;if(t&&"object"==typeof e&&null!==e?n={...a,...e}:(n={...a,[e]:s},"region_id"===e&&s&&!isNaN(s)?n[e]=parseInt(s,10):"region_id"!==e||""!==s&&null!==s||(n.region_id="",n.region="")),n.same_as_billing){const e={...n};delete e.same_as_billing,delete e.save_in_address_book,L(e)}return n}))}),[]),se=e.useCallback(((e,s,t=!1)=>{L((a=>{if(t&&"object"==typeof e&&null!==e)return{...a,...e};const n={...a,[e]:s};return"region_id"===e&&s&&!isNaN(s)?n[e]=parseInt(s,10):"region_id"!==e||""!==s&&null!==s||(n.region_id="",n.region=""),n}))}),[]),te=e.useCallback((()=>{q((e=>{const s=!e.same_as_billing,t={...e,same_as_billing:s};if(s){const e={...t};delete e.same_as_billing,delete e.save_in_address_book,L(e)}return t}))}),[]),ae=e.useCallback((async()=>{E((e=>({...e,address:!0}))),p(null);try{const e=["firstname","lastname","street","city","country_id","postcode","telephone","email"].filter((e=>"street"===e?!$.street[0]:!$[e]));if(e.length>0)throw new Error(`Please fill in all required fields: ${e.join(", ")}`);if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($.email))throw new Error("Please enter a valid email address.");const s={country_id:$.country_id,postcode:$.postcode,region:$.region,...$.region_id&&!isNaN($.region_id)&&""!==$.region_id&&{region_id:parseInt($.region_id,10)}},t=await j(s,J);if(B(t||[]),!(t&&t.length>0))throw T(null),new Error("No shipping methods available for the provided address.");T(t[0]),P((e=>({...e,address:!0}))),A((e=>({...e,address:!1,shipping:!0,payment:!1,review:!1})))}catch(e){p(e.message||"Failed to save shipping information. Please try again.")}finally{E((e=>({...e,address:!1})))}}),[$,J]),ne=e.useCallback((async()=>{E((e=>({...e,shipping:!0}))),p(null);try{if(!O)throw new Error("Please select a shipping method.");await b($.same_as_billing?$:{...$,billing_address:I},O,J);const e=await x(J);Y(e||[]),e&&e.length>0?D(e[0]):D(null);const s=await v(J);Q(s),P((e=>({...e,shipping:!0}))),A((e=>({...e,address:!1,shipping:!1,payment:!0,review:!1})))}catch(e){p(e.message||"Failed to save shipping method. Please try again.")}finally{E((e=>({...e,shipping:!1})))}}),[$,I,O,J]),ie=e.useCallback((async()=>{E((e=>({...e,payment:!0}))),p(null);try{if(!U)throw new Error("Please select a payment method.");P((e=>({...e,payment:!0}))),A((e=>({...e,address:!1,shipping:!1,payment:!1,review:!0})))}catch(e){p(e.message||"Failed to save payment method. Please try again.")}finally{E((e=>({...e,payment:!1})))}}),[U]),re=e.useCallback((async()=>{E((e=>({...e,review:!0}))),p(null);try{if(!U)throw new Error("Payment method not selected.");const e={method:U.code,email:$.email},s=await y(e,J);Z(s),await d(),P((e=>({...e,review:!0,address:!0,shipping:!0,payment:!0}))),A({address:!1,shipping:!1,payment:!1,review:!1})}catch(e){p(e.message||"Failed to place order. Please try again.")}finally{E((e=>({...e,review:!1})))}}),[U,$.email,J,d]);return o&&!W?s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx(l,{size:"lg"})})}):s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Checkout"}),u&&s.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",role:"alert",children:s.jsx("p",{children:u})}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[s.jsx("div",{className:"lg:w-2/3",children:W?s.jsx(S,{orderId:W}):s.jsxs(s.Fragment,{children:[s.jsx(N,{shippingAddress:$,billingAddress:I,handleShippingAddressChange:ee,handleBillingAddressChange:se,toggleSameAsBilling:te,countries:V,sectionCompleted:F,sectionExpanded:g,toggleSection:X,saveShippingAddress:ae,sectionLoading:M.address}),s.jsx(_,{shippingMethods:R,selectedShippingMethod:O,setSelectedShippingMethod:T,sectionCompleted:F,sectionExpanded:g,toggleSection:X,saveShippingMethod:ne,sectionLoading:M.shipping}),s.jsx(w,{paymentMethods:z,selectedPaymentMethod:U,setSelectedPaymentMethod:D,sectionCompleted:F,sectionExpanded:g,toggleSection:X,savePaymentMethod:ie,sectionLoading:M.payment}),s.jsx(C,{shippingAddress:$,billingAddress:I,selectedShippingMethod:O,selectedPaymentMethod:U,cartItems:i,orderSummary:H,sectionCompleted:F,sectionExpanded:g,toggleSection:X,placeOrder:re,sectionLoading:M.review,onCouponApplied:async()=>{const e=await v(J);Q(e)},onCouponRemoved:async()=>{const e=await v(J);Q(e)}})]})}),!W&&i.length>0&&s.jsx("div",{className:"lg:w-1/3",children:s.jsx(k,{cartItems:i,orderSummary:H,selectedShippingMethod:O})})]})]})},F=()=>s.jsx("div",{className:"bg-gray-50 min-h-screen",children:s.jsx(A,{})});export{F as default};
//# sourceMappingURL=Checkout-34R6lvxT.js.map
